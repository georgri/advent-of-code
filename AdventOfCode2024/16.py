text = """
#############################################################################################################################################
#...........#...........#.....#...........#.........#.....#...#.........#.......#...#.............................#...#....................E#
#.#####.###.#.#.#######.#.#.#.#.#.#######.#.###.#####.###.#.#.#.###.###.###.###.#.#.#.###.#.#.#.#.#####.#########.#.#.###.#.#.###.#########.#
#.#.......#...#.#...#...#.#.#.#.#...#...#.#.#...#.....#.#...#...#...#.........#.#.#...#.#...#.#.#.#.....#.......#...#...#.#.#.#.#.......#...#
#.#.###########.#.#.#.###.#.#.#.###.#.#.#.#.#####.#####.#########.#########.#.#.#.#####.#####.#.#.#######.###.#.#####.#.#.###.#.#######.#.#.#
#.....#...#.....#.#...#...#.#.#.#...#.#...#.....#.#.......#.....#.......#.......#.#.........#...#.............#...#...#.#.#...#.......#...#.#
#.#####.#.#.#####.#########.#.###.###.#########.#.#.#####.#####.#######.#.#.###.#.#######.###############.###.###.#.#.#.#.#.###.#.###.###.#.#
#.#.....#.#.#.....#.........#.....#...#.......#.....#.#...#...#...#...#.#.#...#.#...#...#.....#...#.....#...#.....#...#.#.........#...#...#.#
###.#####.#.#.#####.#.#############.###.#####.###.###.#.###.#.#.#.#.#.#.###.#.#####.#.#.#.#.#.###.#.###.#.#.#.#######.#.#######.#.#####.###.#
#...#.#...#.#.#.....#.#.......#.#...#...#...#.......#...#...#.#.#...#.#.....#.....#.#.#.#.#.......#.#...#.#...#...#...#.......#.#.#...#.#...#
#.###.#.###.#.#######.#.#.###.#.#.###.#####.#######.#.###.###.###.###.###########.#.#.#.#.#.#.#.###.#.###.###.#.#.#.#.#######.#.#.#.#.#.###.#
#...#.......#...#.....#.#...#...#...#.#...#.....#...#.....#.............#.......#.....#.#.#.#.#...........#.....#.#.#.......#...............#
###.#.#####.###.#.#.###.###.#######.#.#.#.###.#.#.#####.###.###.#.#.###.###.###########.###.#.#.#.#####.###.#####.#.#.#######.#.###.#.###.#.#
#...#.#...#.....#.#...#...#.......#...#.#...#.#.#.....#...#.....#.#...#.....#.....#...#.....#.#.#.#...#.#...#...#.#.#.......#.......#.....#.#
#.###.#.#.#.#####.#.#.###.#######.#####.###.#.#######.#.#.#.#.#######.#####.#.###.#.#.#######.#.###.#.###.###.###.#.#.#####.###.###.#######.#
#.#...#.#.#.....#.#.#.....#...............#...#.......#.#...#.......#.#.#...#.#...#.#.........#.....#.........#...#.#.#...#.........#.......#
#.#####.#.#.###.#.#.#######.#.###########.#####.#######.#######.###.#.#.#.###.#.###########.#################.#.###.#.###.#.#####.#.#.#####.#
#.......#...#.#.#.#.......#.#...#.......#.......#.....#...#...#.#.....#...#...#...#.......#.....#.......#...#.#...#.#.....#.#.....#...#...#.#
#.#####.#.#.#.#.#.#.#####.#.###.#.#####.#####.###.#.#####.#.#.#.###.#####.#.#####.#.#####.#####.#.#####.#.#.#####.#.#####.#.#.#####.###.#.###
#...#...#...#...#.#.....#...#...#.#.#...#...#.....#.....#...#.#...#.....#.#...#.#...#...#.#...#.#...#...#.#.......#.#.......#.#.....#...#...#
###.###.#.#.#.#.#.#####.###.#.###.#.#.###.#.###.#####.#######.#.#.#.#.#.###.#.#.#######.#.###.#.###.#.###.#########.#.#####.###.###.#.#####.#
#.#.#...#.#...#.#.....#...#.#...#.#.#.....#.#...#.....#.......#.#.#.#.#...#.#.#.........#...#.#.....#...#.#.....#...#.#...#.....#.....#...#.#
#.#.#.#.#.#.#.#.#####.###.#####.#.#.###.###.#.###.#.###.#########.###.###.###.#.#.###.#####.#.#########.#.#.#.#.#.#.#.#.#########.#####.#.#.#
#.........#.#.........#.#.....#.#.#...#.....#.#...#.#...#.........#...#.......#.#...#.#.....#.........#.#...#.#...#.#...#.........#...#.#.#.#
#.###.#.#.#.###########.#.###.#.#.#.#.#.#####.###.###.###.#.#.#####.#.#########.#.#.###.#####.#####.###.#.###.#######.###.#########.#.###.#.#
#...#.#.#.....#.............#.#.#...#.#.#...#...#.#...#...#.#.#.....#.#...#...#...#.....#.........#...#.#...#.........#.........#...#.#...#.#
###.###.#.#.#.#.#####.#######.#.#####.#.#.#.###.#.#.#######.#.#.#.#####.#.#.###.#####################.#.###.###########.#######.#.#.#.#.###.#
#.......#.....#.....#...#...#.#.....#.#...#.#.#.#.....#.......#.#.#...#.#.#...#.........#.....#...#...#...#.......#.....#...#...#.#.#...#...#
###.###.#.#####.###.#.#.#.#.#.#.#####.#####.#.#.#####.#.#######.###.#.#.#.###.#.#######.#.###.#.#.#.#####.#######.#.#####.#.###.###.#.###.#.#
#.........#.....#...#.#...#.....#.......#...#.#...#.....#.....#...#.#.#.#...#...#...#.....#.#...#.#.............#.......#.#...#.....#.#...#.#
#.#.###.#.#####.#.#.###########.#.#######.#.#.###.#######.###.#.#.#.#.#.###.#####.#.#######.#####.#.###.#######.#.#.#####.###.#######.#.#####
#.........#...#.#.#.....#.....#.#...#.....#.#...#.......#...#.#.....#.....#.......#...#.....#.....#...#...#...#.#...#...#.#...#.......#.....#
###.###.#.#.#.###.#####.#.###.#.###.#.#####.#.#.#######.###.#.#.###########.#########.###.###.#######.#.#.#.###.#####.#.#.#.#######.###.###.#
#.#.....#...#...#.#...#.#...#.......#.#.......#.......#.....#.#.#.........#.#.......#...#.....#.......#.#...#...#...#.#...#...........#...#.#
#.#.###.#.#####.#.#.###.###.#####.###.#.#############.#######.#.#.#####.#.#.#.#.###.###.#.#######.#####.###.#.###.#.#.###############.#.###.#
#.#.#...#.....#.#.#...#...#.#...#...#.#.#...#.......#.....#...#.#.#.......#.#.#.#...#...#.......#.....#.....#.#...#.#...#.#.....#.....#.#...#
#.#.#.###.###.#.#.###.#.###.#.#.#####.#.#.#.#####.#.#####.#.#####.#.#######.#.#.###.#.#########.#########.#.#.#.###.###.#.#.#.###.#######.#.#
#.#.#...#.#.....#.....#.....#.#.......#...#.......#...#...#.#.....#.#.....#.#.#...#.#...#.......#.......#.#.#.#.#.#.#.#.#...#.............#.#
#.#.###.#.#####.#####.#######.#######.###############.#.###.#.#####.#.#.#.#.#####.#.###.#.###.###.#####.#.#.#.#.#.#.#.#.#.#################.#
#.....#.#.....#.....#...#...#.......#.#.........#...#.#...#.#...#.#.#.#.#.#.#.....#.....#...#.....#.....#...#...#.#...#.#.#...........#...#.#
#.#.###.#####.#########.###.#######.###.#######.###.#.###.#.###.#.#.###.###.#.###.#.#######.#.#####.#####.#.#####.#.#.#.###.#########.###.#.#
#.#.........#...#.....#.#.........#...#.....#...#...#.#.#.#.....#.#...#...........#.#.....#...#...#.#...#.#...#.....#...#...#.......#...#...#
#.#.#.#####.###.#.#.###.#.#####.#.###.#####.#.###.#.#.#.#.#######.###.#######.#####.#.###.#######.#.#.#.###.###.#####.#.#.#########.###.#####
#.#.....#.#...#...#...#.#.#...#.#...#.....#.#...#.#.#.#.#...........#.#.....#.#...#.#.#...........#.#.#...#.........#.......................#
#.###.#.#.###.#######.#.#.#.#.#.#.#.#####.#.###.#.###.#.#########.#.#.#.###.###.#.#.#.#.###.#.#####.#.###.###.###############.#.#####.#####.#
#...#...#...#...#...#.#...#.#.#...#.#...#.....#.#.....#...#.....#.#...#.#.#.....#...#.#...#.#.......#...#...#...#...#.......#.#.#...#.#...#.#
#.#.#.###.#####.###.#.#####.#.#####.###.#######.#.#####.###.###.#.###.#.#.###########.###.###.#.#####.#.###.#####.#.#.#####.#.#.#.#.#.#.###.#
#.#...#...#...#...#.#...#...#.#...#.#...#.......#.......#...#...#...#...#...#...#.#...#.....#.#.#.....#.#.....#...#...#.#...#...#.#.....#...#
#.###.#.###.#.###.#.###.#.###.#.#.#.#.#.#.###.#####.#####.###.#####.#.###.#.#.#.#.#.###.###.#.#.#.#####.#####.#.#######.#.###########.###.#.#
#.............#...#.....#...#...#.#...#.....#.......#.....#.#.....#...#...#...#...#.#.....#.#.#.#.#...#.#...#...#.......#.#...#...#.....#...#
#.#.#.#.#####.#.###.#.#.###.#####.#####.###.###.#.###.#.###.###.#.#####.#########.#.#.#.#.#.#.#.#.###.#.#.#.###.#######.#.#.#.#.#.#.#.#.#.#.#
#.#.#.....#...#.#...#.#...#.....#...#.....#.#...#...#.#.......#.#...............#.#...#.#.#.#.#.......#...#...#.#.....#.....#.#.#...#...#.#.#
#.#.#.#####.#.#.#.#.#.###.###.###.#.#.#####.#.#####.#.#.###.###.#.#############.#######.#.#.#.#####.#########.###.###.#######.#.#####.#####.#
#.#.#.#.....#.#.#.....#...#...#...#.#.......#.#...#...#...#.#...#.#...#.....#.#.........#.#.#.....#.#.......#.....#.#...#...#...#...#.#.....#
#.#.#.#.###.###.###.#.#.###.###.#####.#.#####.#.#.#######.#.#.###.#.#.#.#.#.#.#.#.#######.#.#####.#.#.#####.#.#####.###.#.###.###.#.#.#.###.#
#.#...#.........#...#.#.#...#.#.........#...#.#.#.#.......#.#.#.....#.#.#.#...#...#.....#.#.#.....#.#.#...#.#.......#...#.....#...#.#.#.#...#
#.#.#.#####.#####.###.#.#.###.#########.#.#.#.#.#.#.#.#####.#.#######.#.#.###.#.###.###.#.#.#.#######.###.#.#.#######.###.###.#.#.###.#.#.#.#
#.#.#...#.........#...#...#...........#.#.#.#.#.#.#...#...#.#...#...#.#.#.#.#.#.........#.#...#.......#...#.#.#.....#.#...#...#.#.....#...#.#
#.#.#.#.#.#.#####.#.#########.###.###.#.#.#.#.#.#.#.###.#.#.###.#.#.#.###.#.#.#########.#.#####.###.###.#.#.#.#.###.#.###.#.#.#.#####.#####.#
#.#.#.#...#.....#.#...#.....#...#...#.#.#.#...#.#...#...#.....#.#.#.#.....#.#.....#.....#.#.#...#.#.#...#...#.#...#.#...#.#.#...#.........#.#
#.#.#.#.###.#.#.#.###.#.###.#######.#.#.#.###########.#.#######.#.#.#######.#####.#.###.#.#.#.###.#.#.#####.#.###.#.###.#.#.###.###.#.###.#.#
#.....#.....#.#.#.#...#...#.....#...#.....#...........#.........#.#.....#...#.....#.#...#.#...#...#.#.#.....#...#.#.....#.#...#...#.#.....#.#
#.###.#####.###.#.###.###.#.###.#.#########.###########.#.#.###########.#.#.#.#####.#.###.#.###.###.#.#.###.###.#.#######.###.###.#.#.#.###.#
#...#.#...#.....#...#...#...#...#.#.........#...#.....#.#...#.#.........#.#.#.#.....#...#.#.....#...#.#.#...#...#...#.....#.#.....#...#.....#
#.#.#.#.#.#.###.###.###.###.#.###.#.#.#######.#.#####.#.###.#.#.#.###.#.#.#.#.#.#########.#######.###.#.#.#.#######.###.#.#.#########.#####.#
#.......#...#...#.#.#.#.....#.#...#.#.....#...#.#.....#...#.#...#.#...#...#...#...........#.......#...#...#.......#...#.#...........#.......#
###.#######.###.#.#.#.#######.#.###.#####.#.###.#.#######.#.#####.#####.#####.#########.###.#######.#.###########.###.#.#.#.#######.#.#.###.#
#...#.....#...#...#.#.....#...#...#.#...#...#.#.#.........#.....#...#...#.............#.....#.......#.........#.#.#...#.#.#.#.....#...#...#.#
#.#.#.#####.#.#####.#.#.###.###.#.#.###.#####.#.#.#####.#######.#.#.#.#.#.###########.#.#####.###.###.###.###.#.#.#.###.###.#.#.#####.#.###.#
#.#.................#...#...#...#...........#.#.......#.#...#.....#.......#.......#.#...#.....#.#...#.#...#...#.#...#...#...#.........#.#...#
#.#.#.#####.###.#######.#.#.#.#######.#####.#.#######.#.#.#.#.#####.#########.###.#.#####.#####.###.###.###.###.#####.###.#######.#.#.###.###
#...#.#.......#.#.....#.#...#.#...#.......#.....#.....#...#.#.#...#...#.#.....#...#.......#.......#.....#.#.........#.....#.....#.#.#...#...#
###.#.#.#####.#.#.###.#.###.###.#.#####.#.#.#####.#######.###.#.#.#####.#.#####.###.###.###.#####.#######.###.###.#.#######.###.#.###.#.#.#.#
#...#.#.....#.....#...#.....#...#.......#.#.#...#.#...#.#.#...#.#.....#.#...#.....#.#.......#...#.................#.....#...#.#.#.#...#.#.#.#
#.###.#####.#######.###.#.###.###########.#.#.#.#.#.#.#.#.#.###.#####.#.#.#.#####.#.#.#######.#.###.#######.###########.###.#.#.#.#.#.#.###.#
#.#...#.......#.....#...#.#.......#.......#.#.#.#.#.#...#.#.....#...#...#.#...#.....#.........#...#.........#.......#.#.#...#.#...#.#.#.#...#
#.#####.#.#####.#####.###.#.#####.#####.###.#.#.#.#.#####.#########.#####.###.#####.#.#####.#.###.#######.###.#####.#.#.#.###.###.#.#.#.#.#.#
#...........#...#.#...#.........#.....#.#.#.#.....#.#...............#...#...#.......#.#...#.#.#...#.......#...#.....#.#...#.......#.#...#.#.#
#############.###.#.###.#############.#.#.#.#.#####.#.#############.#.#.###.#######.###.#.###.#.#######.###.###.#####.#####.###.###.#.###.#.#
#.....#.......#...#...#.#.....#.......#.#.#.#.#.......#...#.....#.#...#...#...#...#.....#.#...#.......#.#...#...#.......#...#.....#.#...#.#.#
#.###.#.#######.#####.###.###.#.#######.#.#.#.###.#####.###.###.#.###.###.###.#.#########.#.#########.#.#.###.###.#.#.#.#.###.#.#.#.#.#.#.#.#
#...#.#.#.....#.......#...#...#.#.....#.#...#...#.#.....#...#...#.......#.#...#.....#...#...#.........#.#.#.#.....#.#.#.#.#.#.#.#.#.#.#...#.#
#.#.#.#.#.#.#.#.#######.###.###.#.###.#.#.#####.#.###.###.###.###.#####.#.#.#####.#.###.#####.#.#########.#.#######.#.###.#.#.#.#.#.#.#####.#
#.#.#...#.#...#.........#...#...#...#...#.....#.#.#...#...#.#...#.....#...#.......#.........#.#.#.........#.#.......#.....#.....#.#...#...#.#
#.#.#####.###.#####.#.###.###.#####.###########.#.#.#.#.###.###.#.#.#.#######.#############.#.#.#.#########.#.#######.#####.###.#.###.###.#.#
#.#...#.#.#.#...#...#.#.#.#...#.....#...........#...#.#...#.#...#.#.#.........#.....#.....#.#.#.#.#.........#.#.......#.....#...#.......#.#.#
#.###.#.#.#.#.#.#.###.#.#.###.#.#.#.#.###############.#.#.#.#.###.#.###########.###.#.###.#.#.###.#####.#.###.#.#############.#.#####.#.#.#.#
#.#.#.........#.#.#...#.#.....#.....#.........#.....#.#.#...#...#.#.#...#.......#...#...#...#.#.......#.#.#...#.....#.......#.#.....#.#...#.#
#.#.#.#####.#.#.#.###.#.#######.#####.#######.###.#.#.#.###.###.###.#.#.#.#######.#.#.#.#####.#.###.#.#.###.#######.#.#####.#.#####.#.###.#.#
#...#.....#...#...#...#.......#.....#.......#...#.#.#...#...#.#.......#.#.......#...#.#.....#...#...#.#...#...#.....#...#...#.#...#...#...#.#
#.#.#.###.###.###.#.#####.###.###.#.#.###.#####.#.#.###.#.###.###########.#####.###.###.###.#.###.###.###.###.###.#####.#.###.#.###.#######.#
#...#...#.......#...#.....#...#.....#...#.#...#.#.......#.#...#.....#...#.#.....#...#...#.#.#.#...#.........#...#.......#.....#.#...#.....#.#
#.###.#.#.###.#.#######.###.###.#####.#.###.#.#.#.#######.#.###.#.#.#.#.###.#.###.###.###.#.#.###.#.#.#######.#.###############.#.###.###.#.#
#.....#.#.....#...#...#...#.#...#.....#.....#...#.....#...#.....#.#.#.#.....#.......#.#...#.#.....#.#.......#.#...#...#.........#...#.#.#.#.#
#.###.#.#.#.#.###.#.#.###.#.#.###.###.#############.#.#.###.#####.#.#.#############.#.###.#.#########.#####.###.#.###.#.###.#######.#.#.#.#.#
#.....#.#...#.....#.#.........#.#...#.#...#.........#.#.#.....#...#.#.#.........#...#...#.#...........#...#...#.#...#.#...#...#.....#.#.#...#
#.#.#.#.#.#.#.#####.#######.#.#.#.#.#.#.#.#.#########.#.#.#.###.###.#.#.#######.###.###.#.###########.#.#.###.#.###.#.###.#.#.#.#####.#.#####
#.#.#...#.#.#.......#.....#.#.#...#.#.#.#...#...#.#...#.#.#.....#.#.#...#.....#...#.....#...#.....#.....#...#.#.#...#.#.....#.....#...#...#.#
#.#.#.###.#.#.###.###.###.#.#.#.###.###.#####.#.#.#.###.###.#####.#.#########.###.#######.#.###.#.#.#.#######.###.###.#.###########.#.#.#.#.#
#...#.....#.....#.....#.#.#.#.#...#.#...#...#.#...#.....#...#.#...#.#...........#.#...#...#.....#.#.#...#...#.#...#.........#.......#...#...#
#.#.#.###.#.###.#.#####.#.###.###.#.#.###.#.#.###.###.#.#.###.#.#.#.#.#######.#.#.#.###.#.#####.###.###.#.#.#.#.#.#######.#.#.#######.#.###.#
#.#.....#...#.#.#.......#...#...#.#.#.#...#...#.....#.#...#...#.#...#.......#.#.#.#.#...#...#...#...#.#...#.#.#.#.#.......#...#.#.....#...#.#
#.###.###.#.#.#.#########.#.###.###.#.#.#.#.#######.#.#####.#.#.#####.#.#.#.#.#.#.#.#.#####.#.###.###.###.#.#.#.###.###########.#.#######.#.#
#.......#.#...#...#.......#...#.....#.....#.#.....#.#.....#.#...#.....#.#.#.#...#.#.#...#...#.#...#.......#...#...#.#.......#...#.#.....#.#.#
#####.#.#.#.#####.#.#####.#.#.#.#########.###.###.#######.#.#####.###.#.#.###.#.#.#.#.###.#.###.###.#.###.#####.#.#.#.###.#.#.#.#.###.#.#.#.#
#.......#.#.....#.#.....#.#.#...#.......#.#...#.#.#...#...#.#...#...#.#.#.......#.#...#...#.#...#...#...#.....#...#.#.#...#.#.#.#.#...#.#.#.#
#.###.###.#.#.###.#####.#.#######.#.#####.#.###.#.#.#.#.#.#.#.#.#####.#.###.#.###.#.###.###.#.#######.#.#####.#.###.###.###.#.#.#.#.###.#.###
#.#.....#.#.#...#...#...#...#.....#.......#.#...#...#...#.#.#.#...#...#.#.#.#.#...#.#...#...#.......#.#.....#.#...#...#...#.#.#.#...#...#...#
#.#.#.#.#.#.###.#.#.#.#####.#.#############.#.#.#########.#.#.###.#.###.#.#.#.#.###.#.#############.#####.#.#.###.###.###.#.#.#.#####.#####.#
#.#...#.#.#...#.....#.#...#.#...#.........#.#.#...#.......#.....#...#.#...#.#.#.#...#.#.....#.....#.....#.#.#.......#.#...#...#.........#...#
#.#.#.#.#.#.###.###.#.###.#.###.#.#########.###.###.#######.#.#.#####.###.#.#.#.#.###.#.###.#.#.#.#.###.###.#####.###.#.#####.###########.###
#...#.#.#.........#...#...#.#...#...#.....#...#.....#...#.#.#.#.....#.....#.#.#.#...#...#.#...#.#.....#.....#...#.#...#.........#...#...#...#
#.#.#.#.###.#.###.#####.###.#.#####.#.###.###.#.#####.#.#.#.#######.#.#####.#.#.###.#####.#####.###.#########.#.#.#.###.#########.#.#.#.#.#.#
#.#.#.#...#...#...#.......#...#...#.#.#...#...#.#.....#.........#...#.....#...#.#.........#...#.#...#.......#.#...#.#.....#...#...#.........#
#.#.#.#.###.###.#.#######.###.#.#.#.#.#.###.###.#.#.###########.#.#######.#####.#######.#.#.#.#.#####.#####.#.#####.#.#####.#.#.#########.#.#
#.#.#.#...#...#.#.......#.......#.#...#...#.#...#.#.#.....#.....#.#.....#.....#...#.......#.#.#.......#.....#.#.....#.#.....#...#.........#.#
#.#.#.###.###.#.#######.#######.#.#######.#.###.#.###.###.#.#####.#.###.#########.###.#####.#.#####.###.#####.#.#######.#########.###.###.#.#
#.#.#.#.#.....#.#.#...#...#.....#.........#...#.#...#.#.#...#...#...#...........#...#.#.....#.....#...#.......#.........#.........#...#.....#
#.#.#.#.#######.#.#.#.###.#.#############.###.#.#.#.#.#.#####.#.#.###.#########.###.###.#######.#.#.#####################.#######.#.#.#.#.###
#.#...#...#.....#...#...#.#.#...............#.#.#.#.#.......#.#.#...#.......#.....#.....#.....#.#.#.#...#...............#.#.........#.#.#...#
#.#.###.#.###.#.#####.###.#.#.###.#.#######.#.#.###.#######.#.#.###.#######.#.###########.#.#.#.#.###.#.#.###.#########.#.#.#.#####.###.#.###
#.#.....#...#.#.....#...#...#.#...#.#.......#.#...#.#.....#...#...#...................#.#.#...#.#.....#...#...#...#...#.#.........#.#...#...#
#.###.#####.#.#####.###.#######.###.#.#######.###.#.#.#.#########.#######.#########.#.#.#.#.###.###########.###.#.#.#.#.###########.#.#####.#
#.....#...#.#.....#...#.#.......#...#.#.#.....#...#.#.#.....#.....#.....#.#.......#.#.#.#.#...#.....#...#...#...#...#.#...#.....#...#.#.....#
#.###.#.#.#.#####.###.#.#.#.#########.#.#.###.#.###.#.###.###.#####.#.#.#.#.#####.#.#.#.#.###.#.###.#.#.#.###.#######.#.#.#.###.#.###.###.#.#
#.......#.#.........#.#.#.#.....#.............#.....#.#.#.#...#.......#.#.#.#.......#...#.#.....#.....#.#...#.......#.#.#.#...#...#...#...#.#
#.###.###.#.#.#######.#.#.#####.#.###########.#######.#.#.#.#######.#.#.#.#.#######.#####.#####.#####.#####.###.#####.#.#.#.#.#.###.###.###.#
#.#.......#.#.#...#...#...#...#...#.#.........#.........#.#...#...#.#.#.#.#.........#...#...#.................#.#.....#.......#.#...#...#.#.#
#.#.#.#####.#.#.#.#.###.###.#.#.###.#.#.#####.#.#########.###.#.#.###.#.###.#######.#.#.###.###.#####.#######.#.#.#####.#######.#.###.###.#.#
#.#.#...#...#.#.#...#.#.....#...#...#.#.......#.#...#.....#.#...#.....#...#.#.....#...#...#.....#.......#.....#.#.#.......#.................#
#.#.#.#.#.###.#.#####.#######.#.###.#.#.#######.###.#.###.#.#.###########.#.###.###.###.#.#####.#.###.#.#.#####.#.#.###.#.#.#####.#.#.#######
#.#...#.#...#.#.#.....#.........................#...#.#.....#...#.......#.........................#...#.#.#.....#.#.#.#...#.................#
#.###.#.###.###.###.#.#.#.###.###.#.###.#########.#.#.#####.#.#.#.#####.#.###.#.#.###.###.###.#.###.#.#.#.#.#####.#.#.#.#####.#.#.#####.###.#
#.....#...#.#...#...#.#...#.....#.#.............#.#.#.....#...#.#...#...#...#...#...#...#.#...#.....#.#...#.#...#...#.#.#...#...#.#...#.#...#
#.###.###.#.#.###.###.#.#####.#.#.###.#.#####.#.#.#.#####.#.#.#.###.#.#####.#######.###.#.#.###.#####.###.#.#.#.###.#.#.#.#####.#.#.#.###.#.#
#.#...#...#.#.#...#.....#.....#.#...#...#.....#...#...#...#.....#...#.....#...#.....#.#...#.#...#...#...#.#...#.......#.#.......#.#.#.....#.#
#.#.#.#.#.#.#.#.#########.###.#####.#.#.#.#########.###.###.#.###.#####.#####.#.#####.#.###.#.#.#.#.#.#.#.#########.#.#.#########.#.#######.#
#.#.....#.#...#...........................#.......#.#...#.........#...#.......#.#.....#.#...#.....#...#.#.#...........#...#...#...#.......#.#
#.###.#########.###.#.#.#.#.#.#.#######.###.#.#####.#.###.#.#######.#.#########.#.###.#.#.#####.#####.#.###.#######.###.#.#.#.#.#####.###.#.#
#S..........................#...........#...........#...............#...........#.......#.............#.................#...#.............#.#
#############################################################################################################################################
"""

text_test1 = """
###############
#.......#....E#
#.#.###.#.###.#
#.....#.#...#.#
#.###.#####.#.#
#.#.#.......#.#
#.#.#####.###.#
#...........#.#
###.#.#####.#.#
#...#.....#.#.#
#.#.#.###.#.#.#
#.....#...#.#.#
#.###.#.#.#.#.#
#S..#.....#...#
###############
"""


text_test2 = """
#################
#...#...#...#..E#
#.#.#.#.#.#.#.#.#
#.#.#.#...#...#.#
#.#.#.#.###.#.#.#
#...#.#.#.....#.#
#.#.#.#.#.#####.#
#.#...#.#.#.....#
#.#.#####.#.###.#
#.#.#.......#...#
#.#.###.#####.###
#.#.#...#.....#.#
#.#.#.#####.###.#
#.#.#.........#.#
#.#.#.#########.#
#S#.............#
#################
"""

def read_input(text):
    res = []
    for line in text.split('\n'):
        if not line:
            continue

        res.append(line)

    return res


print(read_input(text_test1))

def find_char(m, ch):
    for i, row in enumerate(m):
        for j, c in enumerate(row):
            if c == ch:
                return i,j
            
    return None


import heapq
from collections import defaultdict

dirs = ((0, 1), (1, 0), (0,-1), (-1, 0))


def adj(m, x,y, cur_dir):
    # return available neighbours and the new direction

    for xo,yo in ((1,0),(-1,0),(0,1),(0,-1)):
        if 0 <= x+xo < len(m) and 0 <= y+yo < len(m[0]) and m[x+xo][y+yo] != '#' and (-xo,-yo) != cur_dir:
            yield x+xo, y+yo, (xo,yo)


def dijkstra(m, sx, sy, tx, ty):
    
    parents = defaultdict(list)

    cur_dir = (0, 1)

    scores = dict()
    scores[(sx,sy, cur_dir)] = 0

    q = [(0, sx,sy, cur_dir)]

    while q:
        score, x,y, cur_dir = heapq.heappop(q)
        
        if (x,y) == (tx,ty):
            return score, parents
        
        for a,b, dir in adj(m, x,y, cur_dir):
            changed = dir != cur_dir
            new_score = score + 1 + 1000* int(changed)
            if ((a,b,dir) in scores and new_score > scores[(a,b,dir)]):
                continue
            parents[(a,b,new_score)].append((x,y,score))

            if (a,b,dir) in scores and new_score == scores[(a,b,dir)]:
                continue

            scores[(a,b,dir)] = new_score
            heapq.heappush(q, (new_score, a,b, dir))

    return -1, None
        





def solve(text):
    m = read_input(text)

    x,y = find_char(m, 'S')
    a,b = find_char(m, 'E')

    return dijkstra(m, x,y, a,b)



print(solve(text)[0])

def dfs(parents, x,y, score, visited):
    
    if (x,y, score) in visited:
        return
    visited.add((x,y, score))

    for a,b, old_score in parents[(x,y, score)]:
        print(a,b, "->", x,y, ';', old_score, score)
        dfs(parents, a,b,old_score,visited)

def solve2(text):
    m = read_input(text)

    x,y = find_char(m, 'S')
    a,b = find_char(m, 'E')

    score, parents = dijkstra(m, x,y, a,b)

    # print(parents)

    # find number of tiles on all optimal paths
    visited = set()
    dfs(parents, a,b, score, visited)
    print(parents)

    visited = set((a,b) for a,b,_ in visited)

    counter = 0
    for i, row in enumerate(m):
        m[i] = list(row)
        for j,c in enumerate(row):
            if (i,j) in visited:
                if c not in '.SE':
                    print ('ALARM!!!')
                    return
                m[i][j] = 'O'
                counter += 1
        print(''.join(m[i]))
    print(counter)
                
    return len(visited)


print(solve2(text))

# 589 too high