text = '''
.#......................#........................#.........................#................#...............................................
...........................................................................................................#...........#....................
........#...................#.......#............................................#....................#.................................#...
.........................................#............#.........................................#...........................................
....................................................................................................................................#.......
#...........................................................................................................................................
................#......................................................#.............#......................................................
......#..............#.........#......#........................#............................................................................
............#.....................................#......................................#...........................#......................
.....................................................................................................#....................#.................
.....................................................................#.......#............................#......#..............#...........
#...........................................................................................................................................
...................................#.....................................#..................................................................
.........#................#................................#...........................#......#.......................#..................#..
...............#....................................#..........................................................#............................
...........................................#..................................................................................#.............
...............................#...........................................#.......#.................#......................................
#..............................................................#..........................................#.................................
...........#.........................................................#.............................................#........................
......................#...........#...........................................#..........#.....#............................................
........................................................#...............................................................#......#............
...#..........#.........................#................................#..................................................................
............................................................................................................................................
..................#..................................#..............#..................................................................#....
...............................#...........................#...................#.............................#..............................
....................................#....................................................#.............#...............#...................#
................................................................................................#...........................................
.#............#............#........................................................#......................................#................
.......#...................................#........#.......................................................................................
..........................................................#.................................................................................
..............................................................................#..............#.......#................................#.....
.................................#..........................................................................#.........#.....................
....................#....................................................................#......................................#...........
........#...................................#.....................................................................#.........................
#........................#.........................#.............................................#..........................................
.................#.........................................#.........................#......................................................
..............................#.................................#.......................................................................#...
......#...............................#..............................................................................#.............#........
......................................................#..................#.................#............#.......#...........................
..............#...........#......................................................#..........................................................
............................................................#...............................................................................
.....................................................................#......................................................................
.#..................#........................................................................#................................#.............
.........................................#..........................................................................#.......................
.........#.....#..............#..............................................#.........#..............#..............................#.....#
...............................................................................................................#............................
...................................................#...................#...................................................#................
.......................#...........#..............................#......................................#..............................#...
...........#................#...............................................................................................................
...........................................................................#.................................#..............................
................#......................................................................#...........#........................................
.....................................................................................................................#........#......#......
..................................................#.............#..............................#............................................
......#.....#...........#..................#..............................................................#.................................
............................................................................................................................................
...................#...................#..................#....................................................#........................#...
............................................................................................................................................
.........................................................................#..................#...............................................
.....................................................................................................................................#.....#
...................................#...........#....................#.......................................................................
..#.....#.....................................................................#.........................#...................................
...........................#.........................#..................................#..........#..................#.....................
..................................................................................#............................................#............
..............#................#...............................#............................................................................
............................................................................................................................................
.....................................#.........#......................................#..............#........#..........#..................
.....#............#...............................................#........................................................................#
..........................................................................................................#.................................
..........#.............#.....#...........................#.....................#...........................................................
...............................................................#.................................#....................................#.....
....................................#..................................#....................................................................
#......................................................................................................#..........#..........#..............
..........................................#.............................................#...................................................
.................#.............................#........#......................................#.........................#...............#..
......................................#..........................................#..........................................................
............#...............................................#...............................................................................
...........................................................................................#..........................................#.....
.....#................#...............................................................................#.....................................
............................#......................#................#.............................................................#.........
...................................#.........................................................................................#..............
.#.......................................................................#.........#........................#...............................
.........................................#.................#.....................................#...............#..........................
..............................#.............................................................................................................
.................#...............................#.............................#.......#.....#.......#......................................
.......................................................................#....................................................................
............................................................................................................................................
......................................#...........................#.........................................................................
.................................................................................#..........................................................
..................................#.......................#.................................................................................
......................#..............................................#...........................#..........................#.....#.....#...
...........................#............#................................................................#.....#............................
...........................................................................................#................................................
............................................................................................................................................
.........#.........#..........................................................#.............................#.........#.............#.......
...........................................#.............#..................................................................................
............................#..........................................................#..........................#.........................
.......................#.........#..........................................................................................................
......#...........................................#....................#.......................#..........#.................................
...............#.................................................................#..........................................#...............
..........................................................#......#....................................................#............#......#.
......................................................................................................#.....................................
...............................................................................................................#............................
...............................#.....#................#.............................#.......................................................
..#............................................................................#...............#..........................#.................
.......#...................................#........................................................#.......................................
..............................................................#........#.....................................#..............................
...........................#.......#..............#......................................................................................#..
......................#......................................................................................................#......#.......
..............#...........................................................................................#.............#...................
..........................................................#.........#.........................#.............................................
.......................................#.......#...............................#..............................#.............................
................................#...................................................#.......................................................
#..........................................#........#..........#............................................................................
...........................................................................#............#.........................#..................#......
............#...........................................................................................#...................................
...................................#........................................................#...............................................
........................#.................................#......#.......................................................#..................
........#................................................................#..................................................................
...................#..............................#.................................#..............#.........#.....#.............#..........
..........................................#...................#........................................................................#....
.........................................................................................................#..................................
..............................#.........................................................#...................................................
.#..............#...........................................................................................................................
...................................#...........#........................................................................#...................
.........#...............................#........................................................................................#.........
....................#........................................................................#.....................#.........#............#.
..............................................................................#.......................#.......#.............................
.................................#.......................#...............#...............#..................................................
............................................................................................................................................
............................#........#......................................................................................................
......................#........................................#................#...........#..............#........................#.......
.....#.......#........................................................................#..........#........................................#.
..................................................#.........................................................................................
...............................................................................................................#.........#..................
.........................#........#........................#.............#..........................#.......................................
..........#..............................#......................#..........................#................................................
#..................................................................................#........................................................
...............................#................................................................................................#...........
.....................................................#.......#.............................................#................................
......#...............#..............#.........#..................#...............................................#......#...............#..
'''


text_test = '''
...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....
'''

def read(text):
    res = []
    for line in text.split('\n'):
        if not line:
            continue

        res.append(line)

    return res

print(read(text_test))


def expand_empty(m):
    m = expand_rows(m)
    #print(m)

    # transpose and expand rows again
    m = transpose(m)

    m = expand_rows(m)

    return m


def transpose(m):
    return list(zip(*m))


def expand_rows(m):
    res = []
    for line in m:
        if  '#' not in line:
            res.append('.' * len(line))
        res.append(line)

    return res


def find_galaxies(m):
    res = []

    for i, line in enumerate(m):
        for j, c in enumerate(line):
            if c == '#':
                res.append((i,j))

    return res


def manhattan_distance(a, b):
    return abs(a[0] - b[0]) + abs(a[1] - b[1])


def solve(text):
    m = read(text)

    m = expand_empty(m)

    galaxies = find_galaxies(m)
    print(galaxies)

    res = 0
    for i, g1 in enumerate(galaxies):
        for j, g2 in enumerate(galaxies):
            if i >= j:
                continue

            res += manhattan_distance(g1, g2)

    print(res)


#solve(text)

def replace_empty(m):
    m = replace_empty_rows(m)
    # print(m)

    # transpose and expand rows again
    m = transpose(m)

    m = replace_empty_rows(m)

    return m


def replace_empty_rows(m):
    res = []
    for line in m:
        if '#' not in line:
            res.append('M' * len(line))
        else:
            res.append(line)

    return res


def manhattan_distance_with_expansion(m, g1, g2, expansion_rate):
    res = 0
    a,b = g1
    x,y = g2

    for i in range(min(a,x), max(a,x)):
        if m[i][g1[1]] == 'M':
            res += expansion_rate
        else:
            res += 1

    for i in range(min(b,y), max(b,y)):
        if m[g1[0]][i] == 'M':
            res += expansion_rate
        else:
            res += 1

    print(g1, g2, res)
    return res


def solve2(text, expansion_rate):
    m = read(text)

    m = replace_empty(m)

    for line in m:
        print(line)

    galaxies = find_galaxies(m)
    print(galaxies)

    res = 0
    for i, g1 in enumerate(galaxies):
        for j, g2 in enumerate(galaxies):
            if i >= j:
                continue

            res += manhattan_distance_with_expansion(m, g1, g2, expansion_rate)

    print(res)


solve2(text, 1000000)